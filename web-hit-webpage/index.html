<!DOCTYPE HTML>
<html>
	<head>
		<title>Spacebrew Hit Webpage</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="css/reset.css" type="text/css" media="screen" charset="utf-8" />
		<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
		<!-- basic libraries -->
    <script type="text/javascript" src="../jslib/jq-1.7.min.js"></script>
    <script type="text/javascript" src="../jslib/sb-1.4.1.min.js"></script>
<script type="text/javascript">

$(document).ready( function() {
	setup();
});

function gup( name ) {
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}

var index = 0;

var address = unescape(gup('address'));//the address of the website you want to hit

var sb;
var setup = function(){
  sb = new Spacebrew.Client(undefined,
                            undefined,
                            "This is a client which goes to some wepage when it receives a bang.",
                            {debug: true});
  sb.addSubscribe("Bang!", "boolean");
  sb.onBooleanMessage = function onBoolean(name, value){
    $.get(address);
    incrementIndex();
    document.getElementById("output").innerHTML =
      address+" has been visited "+index+" times";
  };
    
  sb.onOpen = function onOpen(){
    console.log("WebSockets connection opened");
    document.getElementById("output").innerHTML = 
      "send a bang to visit " + address;
  };
  sb.onClose = function onClose(){
    console.log("WebSockets connection closed");
    document.getElementById("output").innerHTML = 
      "no longer connected to spacebrew :(";
  };

  sb.connect();
};

function incrementIndex() {
    index += 1;
    //console.log(index);
}

</script>
		<!-- MAIN -->
	</head>
	<body>
    <h3 id="output">Not connected to Spacebrew :(</h3>
  </body>
</html>
